<!-- lobby.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ping Pong Lobby</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css">
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
  <script src="firebase.js"></script>
  <style>
    body { background:#222; color:#fff; }
    .room { cursor:pointer; }
    .room .card { background:#333; }
  </style>
</head>
<body class="p-4">
  <h1 class="mb-4">Ping Pong Lobby</h1>
  <div class="row g-4">
    <div class="col-md-6 room" data-room="masa1">
      <div class="card p-3">
        <h3>Table 1</h3>
        <p>Players: <span id="masa1-players">0</span>/2</p>
        <p>Time: <span id="masa1-time">0</span> min</p>
      </div>
    </div>
    <div class="col-md-6 room" data-room="masa2">
      <div class="card p-3">
        <h3>Table 2</h3>
        <p>Players: <span id="masa2-players">0</span>/2</p>
        <p>Time: <span id="masa2-time">0</span> min</p>
      </div>
    </div>
  </div>

  <script>
    const db = firebase.database()
    const rooms = ['masa1','masa2']

    rooms.forEach(r=>{
      const ref = db.ref('rooms/'+r)
      // on player count
      ref.child('players').on('value',snap=>{
        document.getElementById(r+'-players').textContent = snap.numChildren()
      })
      // on creation timestamp
      ref.child('createdAt').once('value',snap=>{
        if(!snap.exists()) {
          ref.child('createdAt').set(Date.now())
          document.getElementById(r+'-time').textContent = '0'
        }
      })
      // update elapsed time every minute
      setInterval(async()=>{
        const { createdAt } = (await ref.child('createdAt').get()).val()||{}
        if(createdAt) {
          let mins = Math.floor((Date.now()-createdAt)/60000)
          document.getElementById(r+'-time').textContent = mins
        }
      },60000)
    })

    document.querySelectorAll('.room').forEach(el=>{
      el.onclick = ()=>{
        const room = el.dataset.room
        // prompt role
        let role = prompt('Choose role: player1, player2 or viewer','viewer')
        if(!['player1','player2','viewer'].includes(role)) role='viewer'
        window.location = `game.html?room=${room}&role=${role}`
      }
    })
  </script>
</body>
</html>
