<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ping Pong Lobi</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: url('background.PNG') center/cover no-repeat;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .rooms {
      display: flex;
      gap: 2rem;
    }
    .room {
      background: rgba(255,255,255,0.8);
      padding: 1rem;
      border-radius: 8px;
      width: 200px;
      text-align: center;
    }
    .room h2 { margin-top: 0; }
    .status { margin: .5rem 0; }
    .btn { margin: .25rem 0; padding: .5rem; width: 100%; cursor: pointer; }
    .reset { margin-top: 1rem; font-size: .8rem; }
  </style>
</head>
<body>
  <div class="rooms">
    <div class="room" id="room1">
      <h2>Masa 1</h2>
      <div class="status" id="status1">Yükleniyor…</div>
      <button class="btn" onclick="join('room1','player1')">Player 1 Olarak Katıl</button>
      <button class="btn" onclick="join('room1','player2')">Player 2 Olarak Katıl</button>
      <button class="btn" onclick="join('room1','viewer')">İzleyici Olarak Katıl</button>
      <div class="reset">
        <input type="password" id="pwd1" placeholder="Şifre" style="width:100%;padding:.25rem">
        <button class="btn" onclick="resetRoom('room1')">Reset</button>
      </div>
    </div>
    <div class="room" id="room2">
      <h2>Masa 2</h2>
      <div class="status" id="status2">Yükleniyor…</div>
      <button class="btn" onclick="join('room2','player1')">Player 1 Olarak Katıl</button>
      <button class="btn" onclick="join('room2','player2')">Player 2 Olarak Katıl</button>
      <button class="btn" onclick="join('room2','viewer')">İzleyici Olarak Katıl</button>
      <div class="reset">
        <input type="password" id="pwd2" placeholder="Şifre" style="width:100%;padding:.25rem">
        <button class="btn" onclick="resetRoom('room2')">Reset</button>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "...",
      authDomain: "...",
      databaseURL: "https://masa-tenisi-v1-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "masa-tenisi-v1",
      storageBucket: "...",
      messagingSenderId: "...",
      appId: "..."
    };
    // Init
    const app = firebase.initializeApp(firebaseConfig);
    const db  = firebase.database();

    // Odaları dinle
    ['room1','room2'].forEach(room => {
      const statusEl = document.getElementById('status' + room.slice(-1));
      const refRoom = db.ref('rooms/' + room);
      refRoom.on('value', snap => {
        const v = snap.val() || {};
        const p1 = v.player1 ? 'DOLU' : 'BOŞ';
        const p2 = v.player2 ? 'DOLU' : 'BOŞ';
        statusEl.textContent = `P1: ${p1} — P2: ${p2}`;
      });
    });

    function join(room, role) {
      // Boşsa rezerve et
      const refRoom = db.ref('rooms/' + room + '/' + role);
      refRoom.transaction(curr => curr||true);
      // Url ye yönlendir
      window.location = `game.html?room=${room}&role=${role}`;
    }

    function resetRoom(room) {
      const pwd = document.getElementById('pwd'+room.slice(-1)).value;
      if(pwd==='1234'){
        db.ref('rooms/' + room).set({player1:false,player2:false});
        db.ref('game/'+room).remove();
        alert(`${room} resetlendi.`);
      } else alert('Yanlış şifre');
    }
  </script>
</body>
</html>
