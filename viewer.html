<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ping Pong Viewer</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
    rel="stylesheet"
  />
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
  <style>
    body { margin:0; overflow:hidden; background:#000; color:#fff; font-family:'Press Start 2P',monospace; }
    header { display:flex; justify-content:space-between; padding:1rem; }
    .arena { position:fixed; top:50%; left:50%; width:900px; height:600px;
             margin:-300px 0 0 -450px; background:#333; border:3px dashed #fff; }
    .player-left-paddle, .player-right-paddle, .ping-pong-ball {
      position:absolute; background:#fff;
    }
    .player-left-paddle { width:12px; height:85px; left:0; }
    .player-right-paddle { width:12px; height:85px; right:0; }
    .ping-pong-ball { width:15px; height:15px; border-radius:50%; }
    footer { position:fixed; bottom:0; width:100%; text-align:center; font-size:.75rem; }
  </style>
</head>
<body>
  <header>
    <div>Player 1: <span id="score1">0</span></div>
    <h1>Viewer Mode</h1>
    <div>Player 2: <span id="score2">0</span></div>
  </header>

  <div class="arena">
    <div id="paddle1" class="player-left-paddle"></div>
    <div id="ball" class="ping-pong-ball"></div>
    <div id="paddle2" class="player-right-paddle"></div>
  </div>

  <footer>({{ room }})</footer>

  <script>
  // ← Firebase init
  const firebaseConfig = {
    apiKey: "AIzaSyASZrCdc3xrJ8iXagE3iMUdhEpPR5FiJOE",
    authDomain: "masa-tenisi-v1.firebaseapp.com",
    databaseURL:
      "https://masa-tenisi-v1-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "masa-tenisi-v1",
    storageBucket: "masa-tenisi-v1.appspot.com",
    messagingSenderId: "186015084983",
    appId: "1:186015084983:web:86f9d88e907423f5e33832",
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // parse room
  const room = new URLSearchParams(location.search).get("room");
  const rootRef  = db.ref(`rooms/${room}`);
  const paddlesRef = rootRef.child("paddles");
  const ballRef = rootRef.child("ball");
  const scoreRef = rootRef.child("scores");
  document.querySelector("footer").textContent = room;

  // grab els
  const p1 = document.getElementById("paddle1");
  const p2 = document.getElementById("paddle2");
  const b  = document.getElementById("ball");
  const s1 = document.getElementById("score1");
  const s2 = document.getElementById("score2");

  // subscribe
  paddlesRef.on("value", snap => {
    const ps = snap.val()||{};
    if (ps.player1 != null) p1.style.top = ps.player1+"px";
    if (ps.player2 != null) p2.style.top = ps.player2+"px";
  });
  ballRef.on("value", snap => {
    const d = snap.val();
    if (d) { b.style.left = d.x+"px"; b.style.top = d.y+"px"; }
  });
  scoreRef.on("value", snap => {
    const sc = snap.val()||{};
    s1.textContent = sc.player1||0;
    s2.textContent = sc.player2||0;
  });
  </script>
</body>
</html>
